<!DOCTYPE html>
<html>
    <head>
        <title>REP #1 - Valley Children's Hospital</title>
        <!-- Styling -->
        <link rel="stylesheet" type="text/css" href="../static/style.css"/>

        <!-- Quick Redirects that don't interact with API -->
        <script language="javascript" type="text/javascript">
            function RedirectHome()
            {
                location.replace("./home.html");
            }

            function ShowReportTypes()
            {
                // Make the Report Types visible
                var R = document.getElementById("ReportsDiv");
                R.style.display = "block";

                // Query for the exams based on the patient id
                var p_id = document.getElementById("pat_id").value;
                var request = new XMLHttpRequest();
                var url = "/report/"+p_id+"/exams";
                var listOfExams = "";
                let bool = false;
                request.open("GET", url, true);
                request.send();
                request.onload = () => {
                    listOfExams += "<table> <tr> <th> </th> <th> Exam ID </th>  <th> Exam Date </th></tr>";
                    var exms = request.responseText;
                    bool = true;
                    const array = [];
                    var t = exms.replaceAll(/[,\\""]/g,"").replaceAll('[','').replaceAll(']','').split(" ");
                    ti = 0;
                    for(i = 0;i<(t.length);i+=8){
                        var x = t.slice(i, i+8);
                        array[ti] = x;
                        ti++;
                    }
                    for(i = 0; i<=ti; i++)
                    {
                        document.getElementById("exam_list").innerHTML = listOfExams;
                        listOfExams += ("<tr> <td> <button type='checkbox' onClick='gen_report("+ array[i][0]+")'>Select Exam "+ array[i][0]+"</button> <td>" + array[i][0].toString() + "</td> <td>" + array[i][2].toString() + "</td></tr>");
                    }
                }                
                listOfExams += "</table>";
                console.log(listOfExams);
                var htmlObject = $(listOfExams);
                document.getElementById("exam_list").innerHTML = htmlObject;
            }

            function gen_report(exam_id)
            {
                var p_id = document.getElementById("pat_id").value;
                var e_id = exam_id;

                var request = new XMLHttpRequest();
                var url = "/report/"+p_id+"/" + e_id;
                
                let bool = false;
                request.open("POST", url, true);
                request.send();
                // request.onload = () => {
                //     var exam = request.responseText;
                //     console.log(exam);
                //     bool = true;
                //     return exam;
                // }
            }

            function ShowExams(examType)
            {
                var E = document.getElementById("ExamsDiv");
                if (examType == '1'){
                    document.getElementById("amount_mess").innerHTML = "Select ONE (1) exam";
                    
                }
                else{
                    document.getElementById("amount_mess").innerHTML = "Select TWO (2) exams";
                }
                E.style.display = "block";

                
            }
            function ShowReportContent()
            {
                var p_id = document.getElementById("pat_id").value;
                var e_id = document.getElementById("exam").value;
                var request = new XMLHttpRequest();
                var url = "/report/"+p_id+"/1";//+e_id;
                
                let bool = false;
                request.open("GET", url, true);
                request.send();
                request.onload = () => {
                    var exam = request.responseText;
                    console.log(exam);
                    bool = true;
                    // for(let i = 0; i <= names.length; i++)
                    // {
                    //     document.getElementById("exams_list").innerHTML = listOfExams;
                    //     listOfExams += ("<tr> <td>" + names[i].toString() + "</td> <td>" + grades[names[i]].toString() + "</td></tr>");
                    // }
                    // document.getElementById("exam").innerHTML = exam;
                    return exam;
                }
            }
            
        </script>
    </head>
    <body>
        <!-- Nav Bar for quick navigation -->
        <div class="nav">
            <form method="GET"> 
               <a href={{url_for('start')}}>Home</a>
               <a id="logo" href={{url_for('start')}}>V-ARM</a>
               <!-- <a href={{url_for('Logout')}}>Logout</a> -->
            </form> 
        </div>

        <!-- Main Content for Doctor -->
        <div class="main">
            <h1>V-ARM</h1>

            <!-- store Patient ID -->
            <h2>Enter the Patient ID</h2>
            <label>Patient ID:</label>
            <input type="text" placeholder="Patient ID" id="pat_id">

            <button type="button" class='btn' onClick="ShowReportTypes()">SUBMIT</button>
            <button type="button" class='btn' onClick="RedirectHome()">BACK</button>
            
            <div id="ReportsDiv" style="display:none">
                <h2>Select a Report Type</h2>
                <!-- Two Options (REPORT or EXAM) -->
            <table>
                <tr>
                    <th>Single</th>
                    <th>Progressive</th>
                    <th>Comparative</th>
                </tr>
                <tr>
                    <td>
                        Single Report displays the results of ONE (1) examination.
                        <br><br>
                        <button type="button" onClick="ShowExams(1)">Single Report</button>
                        <br><br>
                    </td>
                    <td>
                        Progressive Report compares two examinations by a single patient. 
                        <br><br>
                        (<i>Note: You will select TWO (2) exams by the patient for a comparison.</i>)
                        <br><br>
                        <button type="button" onClick="ShowExams(2)">Progressive Report</button>
                        <br><br>
                    </td>
                    <td>
                        Comparative Report compares two examinations of two different patients. 
                        <br><br>
                        (<i>Note: You will select TWO (2) exams from different patients for a comparison</i>)
                        <br><br>
                        <button type="button" onClick="ShowExams(2)">Comparative Report</button>
                        <br><br>
                    </td>
                </tr>
                
            </table>
            </div>

        <!-- Show all of the exams linked to the patient ID -->
            <div id="ExamsDiv" style="display:none">
                <h2 id="amount_mess"></h2>
                <p id="exam_list"></p>
                <form action={{url_for('report2')}}>
                    <!-- <button type="button">Generate Report</button> -->
                    <input class="btn" type="submit" value="NEXT">
                </form>
            </div>

            
        </div>

        <footer>
            <p>@ Valley Children's Hospital (Team V-ARM) 2022 </p>
            <!-- <p><a href="mailto:hege@example.com">hege@example.com</a></p> -->
        </footer> 
    </body>
</html>